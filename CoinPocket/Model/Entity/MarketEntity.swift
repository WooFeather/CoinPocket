//
//  MarketEntity.swift
//  CoinPocket
//
//  Created by 조우현 on 4/18/25.
//

import Foundation

struct MarketEntity {
    let id: String
    let name: String
    let symbol: String
    let image: String
    let currentPrice: Double // 현재가
    let high24h: Double? // 24시간 고가
    let low24h: Double? // 24시간 저가
    let priceChangePercentage24h: Double? // 24시간 변동폭
    let ath: Double // 사상 최고가(신고점)
    let atl: Double // 사상 최저가(신저점)
    let lastUpdated: String // 최근 업데이트 시간
    let sparklineIn7d: SparklineData?
}

struct SparklineData {
    let price: [Double] // 일주일간 코인 시세
}

extension MarketDTO {
    func toEntity() -> MarketEntity {
        MarketEntity(
            id: self.id,
            name: self.name,
            symbol: self.symbol,
            image: self.image,
            currentPrice: self.currentPrice,
            high24h: self.high24h,
            low24h: self.low24h,
            priceChangePercentage24h: self.priceChangePercentage24h,
            ath: self.ath,
            atl: self.atl,
            lastUpdated: self.lastUpdated,
            sparklineIn7d: self.sparklineIn7d.map { SparklineData(price: $0.price) }
        )
    }
}

struct SparklinePoint: Identifiable {
    let id: Int // index
    let price: Double // value
}

extension MarketEntity {
    var sparklinePoints: [SparklinePoint] {
        sparklineIn7d?.price.enumerated().map { SparklinePoint(id: $0, price: $1) } ?? []
    }
    
    static var mockData: [MarketEntity] {
        [
            MarketEntity(
                id: "bitcoin",
                name: "Bitcoin",
                symbol: "btc",
                image: "https://coin-images.coingecko.com/coins/images/1/large/bitcoin.png?1696501400",
                currentPrice: 120033477,
                high24h: 121020144,
                low24h: 118835727,
                priceChangePercentage24h: -0.18651,
                ath: 157802010,
                atl: 75594,
                lastUpdated: "2025-04-18T06:46:27.805Z",
                sparklineIn7d: SparklineData(price: [
                    0.3990106956257132,
                    0.3980267870179394,
                    0.4003091700533071,
                    0.39789858782449516,
                    0.4004248634125732,
                    0.4016594084239403,
                    0.3954212003659722,
                    0.3974757558533511,
                    0.39155923347472266,
                    0.391443271386638,
                    0.39153884264012995,
                    0.38626553078379444,
                    0.37993973056417246,
                    0.38839011467903356,
                    0.39119489152437864,
                    0.3899734325382012,
                    0.3975613419069324,
                    0.4031748706817603,
                    0.40650922820784285,
                    0.40178319865802037,
                    0.4041483840100976,
                    0.40465787993875096,
                    0.4052888249090503,
                    0.3978471855774058,
                    0.40532663928156565,
                    0.4042707040769094,
                    0.39561712275792205,
                    0.3947013546603531,
                    0.3936546303474588,
                    0.3984466541895871,
                    0.40303936024574916,
                    0.4045064806934865,
                    0.4087702215385585,
                    0.4126753969022644,
                    0.40803890812664484,
                    0.41172603133685826,
                    0.40719918746419964,
                    0.40575090084679394,
                    0.4030967284308249,
                    0.4048585338282606,
                    0.4058526770554015,
                    0.40989820442085634,
                    0.41156080649060883,
                    0.4144054103926439,
                    0.4242517641490022,
                    0.43018423262736527,
                    0.4534167149237453,
                    0.44201921927368254,
                    0.45418149878425196,
                    0.4616268168429775,
                    0.4664770482464353,
                    0.5021030401662416,
                    0.48336978891737825,
                    0.474849587425198,
                    0.479463333326564,
                    0.48055703999837396,
                    0.48793304783065267,
                    0.4975467976700578,
                    0.49093153367032744,
                    0.4956334967663455,
                    0.4848309964949347,
                    0.491628467399573,
                    0.483515080486474,
                    0.4792072898397764,
                    0.4741890328712821,
                    0.4805336118935533,
                    0.4820751307274347,
                    0.4839927426191879,
                    0.48764928740350433,
                    0.4809649526198671,
                    0.4536636402923025,
                    0.5014246931918798,
                    0.4957380771485577,
                    0.4971826802375126,
                    0.48722721484188436,
                    0.4842173853476247,
                    0.4834230664177316,
                    0.4936636493130175,
                    0.5109031657502856,
                    0.5046502271645729,
                    0.5147586189349194,
                    0.5066234755817867,
                    0.5007759675441235,
                    0.5115157752857667,
                    0.5341529000776327,
                    0.5210395115184646,
                    0.50401974002648,
                    0.5031567255375823,
                    0.5274883119311098,
                    0.5123913606699074,
                    0.5163909088529132,
                    0.5020413827455158,
                    0.5078186260205424,
                    0.49758181931484086,
                    0.5060424764500872,
                    0.49064202685236497,
                    0.48895340891478034,
                    0.48836910079956874,
                    0.5052204477858249,
                    0.49277561519108587,
                    0.4932032976700269,
                    0.5008491032533781,
                    0.48760592667953795,
                    0.48386237757837164,
                    0.49015581065051733,
                    0.48357549851728066,
                    0.4844401141433589,
                    0.4860932952176908,
                    0.4906721377999945,
                    0.4927673609169285,
                    0.4793279038495633,
                    0.4848635695662781,
                    0.4906666963791167,
                    0.4921619853080003,
                    0.48624973580728903,
                    0.48239890688802006,
                    0.4901176147281186,
                    0.4833405135580923,
                    0.48472913796980044,
                    0.48345602991651804,
                    0.4804914604822031,
                    0.48506147788310217,
                    0.5052277209676905,
                    0.5008987681557302,
                    0.5186222781100158,
                    0.5280602637453248,
                    0.5489899260071109,
                    0.534037011889448,
                    0.5213663692072792,
                    0.523390470973627,
                    0.5133678651164005,
                    0.5064925970569482,
                    0.5047994064129582,
                    0.5053969442270188,
                    0.5085270147881649,
                    0.5082901230763501,
                    0.5010603052007082,
                    0.5001726205566687,
                    0.4911504169416354,
                    0.4802386153810959,
                    0.46766694615020227,
                    0.4630376941866645,
                    0.46017215639998094,
                    0.4670050742744273,
                    0.4675157176282486,
                    0.4635003557930174,
                    0.4777725669797014,
                    0.4674530632571546,
                    0.463768794512385,
                    0.46672355501313384,
                    0.45628293502601286,
                    0.46613217146888586,
                    0.4631694998487882,
                    0.47560942907636816,
                    0.495191870105746,
                    0.48386439170799556,
                    0.48241033932488475,
                    0.5221814364404782,
                    0.5173090593707391,
                    0.5029911165599256,
                    0.4999314087644439,
                    0.5048016856301432,
                    0.5062290121157632,
                    0.49969950642314,
                    0.4982019087937414,
                    0.49772070392435025
                ])
            ),
            MarketEntity(
                id: "ethereum",
                name: "Ethereum",
                symbol: "eth",
                image: "https://coin-images.coingecko.com/coins/images/279/large/ethereum.png?1696501628",
                currentPrice: 2241286,
                high24h: 2287157,
                low24h: 2223400,
                priceChangePercentage24h: -1.46528,
                ath: 5870966,
                atl: 489.4,
                lastUpdated: "2025-04-18T07:01:43.546Z",
                sparklineIn7d: nil
            ),
            MarketEntity(
                id: "ripple",
                name: "XRP",
                symbol: "xrp",
                image: "https://coin-images.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1696501442",
                currentPrice: 2927.34,
                high24h: 2905.51,
                low24h: 2991.38,
                priceChangePercentage24h: -1.62985,
                ath: 4929.59,
                atl: 2.75,
                lastUpdated: "2025-04-18T07:01:49.313Z",
                sparklineIn7d: nil
            )
        ]
    }
}
